<html>
<head>
<title>QuickStartServerCom.html</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #e8bf6a;}
.s1 { color: #a9b7c6;}
.s2 { color: #bababa;}
.s3 { color: #a5c261;}
.s4 { color: #6d9cbe;}
.ln { color: #606366; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
QuickStartServerCom.html</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">&lt;HTML&gt;</span>
<a name="l2"><span class="ln">2    </span></a><span class="s0">&lt;HEAD&gt;</span>
<a name="l3"><span class="ln">3    </span></a><span class="s0">&lt;META </span><span class="s2">HTTP-EQUIV</span><span class="s3">=&quot;Content-Type&quot; </span><span class="s2">CONTENT</span><span class="s3">=&quot;text/html; charset=windows-1252&quot;</span><span class="s0">&gt;</span>
<a name="l4"><span class="ln">4    </span></a><span class="s0">&lt;META </span><span class="s2">NAME</span><span class="s3">=&quot;Generator&quot; </span><span class="s2">CONTENT</span><span class="s3">=&quot;Microsoft Word 97&quot;</span><span class="s0">&gt;</span>
<a name="l5"><span class="ln">5    </span></a><span class="s0">&lt;TITLE&gt;</span><span class="s1">Quick Start to Server Side COM and Python</span><span class="s0">&lt;/TITLE&gt;</span>
<a name="l6"><span class="ln">6    </span></a><span class="s0">&lt;META </span><span class="s2">NAME</span><span class="s3">=&quot;Version&quot; </span><span class="s2">CONTENT</span><span class="s3">=&quot;8.0.3410&quot;</span><span class="s0">&gt;</span>
<a name="l7"><span class="ln">7    </span></a><span class="s0">&lt;META </span><span class="s2">NAME</span><span class="s3">=&quot;Date&quot; </span><span class="s2">CONTENT</span><span class="s3">=&quot;10/11/96&quot;</span><span class="s0">&gt;</span>
<a name="l8"><span class="ln">8    </span></a><span class="s0">&lt;META </span><span class="s2">NAME</span><span class="s3">=&quot;Template&quot; </span><span class="s2">CONTENT</span><span class="s3">=&quot;D:\Program Files\Microsoft Office\Office\html.dot&quot;</span><span class="s0">&gt;</span>
<a name="l9"><span class="ln">9    </span></a><span class="s0">&lt;/HEAD&gt;</span>
<a name="l10"><span class="ln">10   </span></a><span class="s0">&lt;BODY </span><span class="s2">TEXT</span><span class="s3">=&quot;#000000&quot; </span><span class="s2">LINK</span><span class="s3">=&quot;#0000ff&quot; </span><span class="s2">VLINK</span><span class="s3">=&quot;#800080&quot; </span><span class="s2">BGCOLOR</span><span class="s3">=&quot;#ffffff&quot;</span><span class="s0">&gt;</span>
<a name="l11"><span class="ln">11   </span></a>
<a name="l12"><span class="ln">12   </span></a><span class="s0">&lt;H1&gt;</span><span class="s1">Quick Start to Server side COM and Python</span><span class="s0">&lt;/H1&gt;</span>
<a name="l13"><span class="ln">13   </span></a><span class="s0">&lt;H2&gt;</span><span class="s1">Introduction</span><span class="s0">&lt;/H2&gt;</span>
<a name="l14"><span class="ln">14   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">This documents how to quickly start implementing COM objects in Python. It is not a thorough discussion of the COM system, or of the concepts introduced by COM.</span><span class="s0">&lt;/P&gt;</span>
<a name="l15"><span class="ln">15   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">For more details information on Python and COM, please see the </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;http://www.python.org/windows/win32com/COMTutorial/index.htm&quot;</span><span class="s0">&gt;</span><span class="s1">COM Tutorial given by Greg Stein and Mark Hammond at SPAM 6 (HTML format)</span><span class="s0">&lt;/A&gt; </span><span class="s1">or download the same tutorial </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;http://www.python.org/windows/win32com/COMTutorial.ppt&quot;</span><span class="s0">&gt;</span><span class="s1">in PowerPoint format.</span><span class="s0">&lt;/A&gt;&lt;/P&gt;</span>
<a name="l16"><span class="ln">16   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">For information on using external COM objects from Python, please see </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;QuickStartClientCom.html&quot;</span><span class="s0">&gt;</span><span class="s1">a Quick Start to Client side COM and Python</span><span class="s0">&lt;/A&gt;</span><span class="s1">.</span><span class="s0">&lt;/P&gt;</span>
<a name="l17"><span class="ln">17   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">In this document we discuss the </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;#core&quot;</span><span class="s0">&gt;</span><span class="s1">core functionality</span><span class="s0">&lt;/A&gt;</span><span class="s1">, </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;#Registering&quot;</span><span class="s0">&gt;</span><span class="s1">registering the server</span><span class="s0">&lt;/A&gt;</span><span class="s1">, </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;#testing&quot;</span><span class="s0">&gt;</span><span class="s1">testing the class</span><span class="s0">&lt;/A&gt;</span><span class="s1">, </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;#debugging&quot;</span><span class="s0">&gt;</span><span class="s1">debugging the class</span><span class="s0">&lt;/A&gt;</span><span class="s1">, </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;#Exception&quot;</span><span class="s0">&gt;</span><span class="s1">exception handling</span><span class="s0">&lt;/A&gt; </span><span class="s1">and </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;#Policies&quot;</span><span class="s0">&gt;</span><span class="s1">server policies</span><span class="s0">&lt;/A&gt; </span><span class="s1">(phew!)</span><span class="s0">&lt;/P&gt;</span>
<a name="l18"><span class="ln">18   </span></a><span class="s0">&lt;H2&gt;&lt;A </span><span class="s2">NAME</span><span class="s3">=&quot;core&quot;</span><span class="s0">&gt;</span><span class="s1">Implement the core functionality</span><span class="s0">&lt;/A&gt;&lt;/H2&gt;</span>
<a name="l19"><span class="ln">19   </span></a><span class="s0">&lt;H3&gt;&lt;A </span><span class="s2">NAME</span><span class="s3">=&quot;Using&quot;</span><span class="s0">&gt;</span><span class="s1">Implement a stand-alone Python class with your functionality</span><span class="s0">&lt;/A&gt;&lt;/H3&gt;</span>
<a name="l20"><span class="ln">20   </span></a><span class="s0">&lt;CODE&gt;&lt;P&gt;</span><span class="s1">class HelloWorld:</span><span class="s0">&lt;/P&gt;&lt;DIR&gt;</span>
<a name="l21"><span class="ln">21   </span></a><span class="s0">&lt;DIR&gt;</span>
<a name="l22"><span class="ln">22   </span></a>
<a name="l23"><span class="ln">23   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">def __init__(self):</span><span class="s0">&lt;/P&gt;&lt;DIR&gt;</span>
<a name="l24"><span class="ln">24   </span></a><span class="s0">&lt;DIR&gt;</span>
<a name="l25"><span class="ln">25   </span></a>
<a name="l26"><span class="ln">26   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">self.softspace = 1</span><span class="s0">&lt;/P&gt;</span>
<a name="l27"><span class="ln">27   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">self.noCalls = 0</span><span class="s0">&lt;/P&gt;&lt;/DIR&gt;</span>
<a name="l28"><span class="ln">28   </span></a><span class="s0">&lt;/DIR&gt;</span>
<a name="l29"><span class="ln">29   </span></a>
<a name="l30"><span class="ln">30   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">def Hello(self, who):</span><span class="s0">&lt;/P&gt;&lt;DIR&gt;</span>
<a name="l31"><span class="ln">31   </span></a><span class="s0">&lt;DIR&gt;</span>
<a name="l32"><span class="ln">32   </span></a>
<a name="l33"><span class="ln">33   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">self.noCalls = self.noCalls + 1</span><span class="s0">&lt;/P&gt;</span>
<a name="l34"><span class="ln">34   </span></a><span class="s0">&lt;P&gt;</span><span class="s1"># insert &quot;softspace&quot; number of spaces</span><span class="s0">&lt;/P&gt;</span>
<a name="l35"><span class="ln">35   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">return &quot;Hello&quot; + &quot; &quot; * self.softspace + who</span><span class="s0">&lt;/P&gt;&lt;/DIR&gt;</span>
<a name="l36"><span class="ln">36   </span></a><span class="s0">&lt;/DIR&gt;</span>
<a name="l37"><span class="ln">37   </span></a><span class="s0">&lt;/DIR&gt;</span>
<a name="l38"><span class="ln">38   </span></a><span class="s0">&lt;/DIR&gt;</span>
<a name="l39"><span class="ln">39   </span></a>
<a name="l40"><span class="ln">40   </span></a><span class="s0">&lt;/CODE&gt;&lt;P&gt;</span><span class="s1">This is obviously a very simple server. In particular, custom error handling would be needed for a production class server. In addition, there are some contrived properties just for demonstration purposes.</span><span class="s0">&lt;/P&gt;</span>
<a name="l41"><span class="ln">41   </span></a><span class="s0">&lt;H3&gt;</span><span class="s1">Make Unicode concessions</span><span class="s0">&lt;/H3&gt;</span>
<a name="l42"><span class="ln">42   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">At this stage, Python and Unicode don’t really work well together. All strings which come from COM will actually be Unicode objects rather than string objects.</span><span class="s0">&lt;/P&gt;</span>
<a name="l43"><span class="ln">43   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">To make this code work in a COM environment, the last line of the &quot;Hello&quot; method must become:</span><span class="s0">&lt;/P&gt;&lt;DIR&gt;</span>
<a name="l44"><span class="ln">44   </span></a><span class="s0">&lt;DIR&gt;</span>
<a name="l45"><span class="ln">45   </span></a><span class="s0">&lt;DIR&gt;</span>
<a name="l46"><span class="ln">46   </span></a><span class="s0">&lt;DIR&gt;</span>
<a name="l47"><span class="ln">47   </span></a>
<a name="l48"><span class="ln">48   </span></a><span class="s0">&lt;CODE&gt;&lt;P&gt;</span><span class="s1">return &quot;Hello&quot; + &quot; &quot; * self.softspace + str(who)</span><span class="s0">&lt;/P&gt;&lt;/DIR&gt;</span>
<a name="l49"><span class="ln">49   </span></a><span class="s0">&lt;/DIR&gt;</span>
<a name="l50"><span class="ln">50   </span></a><span class="s0">&lt;/DIR&gt;</span>
<a name="l51"><span class="ln">51   </span></a><span class="s0">&lt;/DIR&gt;</span>
<a name="l52"><span class="ln">52   </span></a>
<a name="l53"><span class="ln">53   </span></a><span class="s0">&lt;/CODE&gt;&lt;P&gt;</span><span class="s1">Note the conversion of the &quot;who&quot; to &quot;str(who)&quot;. This forces the Unicode object into a native Python string object.</span><span class="s0">&lt;/P&gt;</span>
<a name="l54"><span class="ln">54   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">For details on how to debug COM Servers to find this sort of error, please see </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;#debugging&quot;</span><span class="s0">&gt;</span><span class="s1">debugging the class</span><span class="s0">&lt;/A&gt;&lt;/P&gt;</span>
<a name="l55"><span class="ln">55   </span></a><span class="s0">&lt;H3&gt;</span><span class="s1">Annotate the class with win32com specific attributes</span><span class="s0">&lt;/H3&gt;</span>
<a name="l56"><span class="ln">56   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">This is not a complete list of names, simply a list of properties used by this sample.</span><span class="s0">&lt;/P&gt;</span>
<a name="l57"><span class="ln">57   </span></a><span class="s0">&lt;TABLE </span><span class="s2">CELLSPACING</span><span class="s3">=0 </span><span class="s2">BORDER</span><span class="s3">=0 </span><span class="s2">CELLPADDING</span><span class="s3">=7 </span><span class="s2">WIDTH</span><span class="s3">=637</span><span class="s0">&gt;</span>
<a name="l58"><span class="ln">58   </span></a><span class="s0">&lt;TR&gt;&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;34%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l59"><span class="ln">59   </span></a><span class="s0">&lt;P&gt;&lt;B&gt;</span><span class="s1">Property Name</span><span class="s0">&lt;/B&gt;&lt;/TD&gt;</span>
<a name="l60"><span class="ln">60   </span></a><span class="s0">&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;66%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l61"><span class="ln">61   </span></a><span class="s0">&lt;B&gt;&lt;P&gt;</span><span class="s1">Description</span><span class="s0">&lt;/B&gt;&lt;/TD&gt;</span>
<a name="l62"><span class="ln">62   </span></a><span class="s0">&lt;/TR&gt;</span>
<a name="l63"><span class="ln">63   </span></a><span class="s0">&lt;TR&gt;&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;34%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l64"><span class="ln">64   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_public_methods_</span><span class="s0">&lt;/TD&gt;</span>
<a name="l65"><span class="ln">65   </span></a><span class="s0">&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;66%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l66"><span class="ln">66   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">List of all method names exposed to remote COM clients</span><span class="s0">&lt;/TD&gt;</span>
<a name="l67"><span class="ln">67   </span></a><span class="s0">&lt;/TR&gt;</span>
<a name="l68"><span class="ln">68   </span></a><span class="s0">&lt;TR&gt;&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;34%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l69"><span class="ln">69   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_public_attrs_</span><span class="s0">&lt;/TD&gt;</span>
<a name="l70"><span class="ln">70   </span></a><span class="s0">&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;66%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l71"><span class="ln">71   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">List of all attribute names exposed to remote COM clients</span><span class="s0">&lt;/TD&gt;</span>
<a name="l72"><span class="ln">72   </span></a><span class="s0">&lt;/TR&gt;</span>
<a name="l73"><span class="ln">73   </span></a><span class="s0">&lt;TR&gt;&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;34%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot; </span><span class="s2">HEIGHT</span><span class="s3">=5</span><span class="s0">&gt;</span>
<a name="l74"><span class="ln">74   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_readonly_attrs_</span><span class="s0">&lt;/TD&gt;</span>
<a name="l75"><span class="ln">75   </span></a><span class="s0">&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;66%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot; </span><span class="s2">HEIGHT</span><span class="s3">=5</span><span class="s0">&gt;</span>
<a name="l76"><span class="ln">76   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">List of all attributes which can be accessed, but not set.</span><span class="s0">&lt;/TD&gt;</span>
<a name="l77"><span class="ln">77   </span></a><span class="s0">&lt;/TR&gt;</span>
<a name="l78"><span class="ln">78   </span></a><span class="s0">&lt;/TABLE&gt;</span>
<a name="l79"><span class="ln">79   </span></a>
<a name="l80"><span class="ln">80   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">We change the class header to become:</span><span class="s0">&lt;/P&gt;</span>
<a name="l81"><span class="ln">81   </span></a><span class="s0">&lt;CODE&gt;&lt;P&gt;</span><span class="s1">class HelloWorld:</span><span class="s0">&lt;/P&gt;&lt;DIR&gt;</span>
<a name="l82"><span class="ln">82   </span></a><span class="s0">&lt;DIR&gt;</span>
<a name="l83"><span class="ln">83   </span></a>
<a name="l84"><span class="ln">84   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_public_methods_ = ['Hello']</span><span class="s0">&lt;/P&gt;</span>
<a name="l85"><span class="ln">85   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_public_attrs_ = ['softspace', 'noCalls']</span><span class="s0">&lt;/P&gt;</span>
<a name="l86"><span class="ln">86   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_readonly_attrs_ = ['noCalls']</span><span class="s0">&lt;/P&gt;</span>
<a name="l87"><span class="ln">87   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">def __init__(self):</span><span class="s0">&lt;/P&gt;</span>
<a name="l88"><span class="ln">88   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">[Same from here…]</span><span class="s0">&lt;/P&gt;&lt;/DIR&gt;</span>
<a name="l89"><span class="ln">89   </span></a><span class="s0">&lt;/DIR&gt;</span>
<a name="l90"><span class="ln">90   </span></a>
<a name="l91"><span class="ln">91   </span></a><span class="s0">&lt;/CODE&gt;&lt;H3&gt;&lt;A </span><span class="s2">NAME</span><span class="s3">=&quot;Registering&quot;</span><span class="s0">&gt;</span><span class="s1">Registering and assigning a CLSID for the object</span><span class="s0">&lt;/A&gt;&lt;/H3&gt;</span>
<a name="l92"><span class="ln">92   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">COM requires that all objects use a unique CLSID and be registered under a &quot;user friendly&quot; name. This documents the process.</span><span class="s0">&lt;/P&gt;</span>
<a name="l93"><span class="ln">93   </span></a><span class="s0">&lt;H4&gt;</span><span class="s1">Generating the CLSID</span><span class="s0">&lt;/H4&gt;</span>
<a name="l94"><span class="ln">94   </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Microsoft Visual C++ comes with various tools for generating CLSID's, which are quite suitable. Alternatively, the pythoncom module exports the function CreateGuid() to generate these identifiers.</span><span class="s0">&lt;/P&gt;</span>
<a name="l95"><span class="ln">95   </span></a><span class="s0">&lt;CODE&gt;&lt;P&gt;</span><span class="s4">&amp;gt;&amp;gt;&amp;gt; </span><span class="s1">import pythoncom</span><span class="s0">&lt;BR&gt;</span>
<a name="l96"><span class="ln">96   </span></a><span class="s4">&amp;gt;&amp;gt;&amp;gt; </span><span class="s1">print pythoncom.CreateGuid()</span><span class="s0">&lt;BR&gt;</span>
<a name="l97"><span class="ln">97   </span></a><span class="s1">{7CC9F362-486D-11D1-BB48-0000E838A65F}</span><span class="s0">&lt;/P&gt;</span>
<a name="l98"><span class="ln">98   </span></a><span class="s0">&lt;/CODE&gt;&lt;P&gt;</span><span class="s1">Obviously the GUID that you get will be different than that displayed here.</span><span class="s0">&lt;/P&gt;</span>
<a name="l99"><span class="ln">99   </span></a><span class="s0">&lt;H4&gt;</span><span class="s1">Preparing for registration of the Class</span><span class="s0">&lt;/H4&gt;</span>
<a name="l100"><span class="ln">100  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">The win32com package allows yet more annotations to be applied to a class, allowing registration to be effected with 2 lines in your source file. The registration annotations used by this sample are:</span><span class="s0">&lt;/P&gt;</span>
<a name="l101"><span class="ln">101  </span></a><span class="s0">&lt;TABLE </span><span class="s2">CELLSPACING</span><span class="s3">=0 </span><span class="s2">BORDER</span><span class="s3">=0 </span><span class="s2">CELLPADDING</span><span class="s3">=7 </span><span class="s2">WIDTH</span><span class="s3">=636</span><span class="s0">&gt;</span>
<a name="l102"><span class="ln">102  </span></a><span class="s0">&lt;TR&gt;&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;34%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l103"><span class="ln">103  </span></a><span class="s0">&lt;P&gt;&lt;B&gt;</span><span class="s1">Property Name</span><span class="s0">&lt;/B&gt;&lt;/TD&gt;</span>
<a name="l104"><span class="ln">104  </span></a><span class="s0">&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;66%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l105"><span class="ln">105  </span></a><span class="s0">&lt;B&gt;&lt;P&gt;</span><span class="s1">Description</span><span class="s0">&lt;/B&gt;&lt;/TD&gt;</span>
<a name="l106"><span class="ln">106  </span></a><span class="s0">&lt;/TR&gt;</span>
<a name="l107"><span class="ln">107  </span></a><span class="s0">&lt;TR&gt;&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;34%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l108"><span class="ln">108  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_reg_clsid_</span><span class="s0">&lt;/TD&gt;</span>
<a name="l109"><span class="ln">109  </span></a><span class="s0">&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;66%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l110"><span class="ln">110  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">The CLSID of the COM object</span><span class="s0">&lt;/TD&gt;</span>
<a name="l111"><span class="ln">111  </span></a><span class="s0">&lt;/TR&gt;</span>
<a name="l112"><span class="ln">112  </span></a><span class="s0">&lt;TR&gt;&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;34%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l113"><span class="ln">113  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_reg_progid_</span><span class="s0">&lt;/TD&gt;</span>
<a name="l114"><span class="ln">114  </span></a><span class="s0">&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;66%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot;</span><span class="s0">&gt;</span>
<a name="l115"><span class="ln">115  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">The &quot;program ID&quot;, or Name, of the COM Server. This is the name the user usually uses to instantiate the object</span><span class="s0">&lt;/TD&gt;</span>
<a name="l116"><span class="ln">116  </span></a><span class="s0">&lt;/TR&gt;</span>
<a name="l117"><span class="ln">117  </span></a><span class="s0">&lt;TR&gt;&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;34%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot; </span><span class="s2">HEIGHT</span><span class="s3">=5</span><span class="s0">&gt;</span>
<a name="l118"><span class="ln">118  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_reg_desc_</span><span class="s0">&lt;/TD&gt;</span>
<a name="l119"><span class="ln">119  </span></a><span class="s0">&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;66%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot; </span><span class="s2">HEIGHT</span><span class="s3">=5</span><span class="s0">&gt;</span>
<a name="l120"><span class="ln">120  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Optional: The description of the COM Server. Used primarily for COM browsers.  If not specified, the _reg_progid_ is used as the description.</span><span class="s0">&lt;/TD&gt;</span>
<a name="l121"><span class="ln">121  </span></a><span class="s0">&lt;/TR&gt;</span>
<a name="l122"><span class="ln">122  </span></a><span class="s0">&lt;TR&gt;&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;34%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot; </span><span class="s2">HEIGHT</span><span class="s3">=5</span><span class="s0">&gt;</span>
<a name="l123"><span class="ln">123  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_reg_class_spec_</span><span class="s0">&lt;/TD&gt;</span>
<a name="l124"><span class="ln">124  </span></a><span class="s0">&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;66%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot; </span><span class="s2">HEIGHT</span><span class="s3">=5</span><span class="s0">&gt;</span>
<a name="l125"><span class="ln">125  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Optional: A string which represents how Python can create the class instance. The string is of format</span><span class="s0">&lt;BR&gt;</span>
<a name="l126"><span class="ln">126  </span></a><span class="s1">[package.subpackage.]module.class</span><span class="s0">&lt;/P&gt;</span>
<a name="l127"><span class="ln">127  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">The portion up to the class name must be valid for Python to &quot;import&quot;, and the class portion must be a valid attribute in the specified class.</span><span class="s0">&lt;/P&gt;</span>
<a name="l128"><span class="ln">128  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">This is optional from build 124 of Pythoncom., and has been removed from this sample.</span><span class="s0">&lt;/TD&gt;</span>
<a name="l129"><span class="ln">129  </span></a><span class="s0">&lt;/TR&gt;</span>
<a name="l130"><span class="ln">130  </span></a><span class="s0">&lt;TR&gt;&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;34%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot; </span><span class="s2">HEIGHT</span><span class="s3">=5</span><span class="s0">&gt;</span>
<a name="l131"><span class="ln">131  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_reg_remove_keys_</span><span class="s0">&lt;/TD&gt;</span>
<a name="l132"><span class="ln">132  </span></a><span class="s0">&lt;TD </span><span class="s2">WIDTH</span><span class="s3">=&quot;66%&quot; </span><span class="s2">VALIGN</span><span class="s3">=&quot;TOP&quot; </span><span class="s2">HEIGHT</span><span class="s3">=5</span><span class="s0">&gt;</span>
<a name="l133"><span class="ln">133  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Optional: A list of tuples of extra registry keys to be removed when uninstalling the server. Each tuple is of format (&quot;key&quot;, root), where key is a string, and root is one of the win32con.HKEY_* constants (this item is optional, defaulting to HKEY_CLASSES_ROOT)</span><span class="s0">&lt;/TD&gt;</span>
<a name="l134"><span class="ln">134  </span></a><span class="s0">&lt;/TR&gt;</span>
<a name="l135"><span class="ln">135  </span></a><span class="s0">&lt;/TABLE&gt;</span>
<a name="l136"><span class="ln">136  </span></a>
<a name="l137"><span class="ln">137  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Note there are quite a few other keys available. Also note that these annotations are </span><span class="s0">&lt;I&gt;</span><span class="s1">not</span><span class="s0">&lt;/I&gt; </span><span class="s1">required - they just make registration simple. Helper functions in the module </span><span class="s0">&lt;CODE&gt;</span><span class="s1">win32com.server.register</span><span class="s0">&lt;/CODE&gt; </span><span class="s1">allow you to explicitly specify each of these attributes without attaching them to the class.</span><span class="s0">&lt;/P&gt;</span>
<a name="l138"><span class="ln">138  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">The header of our class now becomes:</span><span class="s0">&lt;/P&gt;</span>
<a name="l139"><span class="ln">139  </span></a><span class="s0">&lt;CODE&gt;&lt;P&gt;</span><span class="s1">class HelloWorld:</span><span class="s0">&lt;/P&gt;&lt;DIR&gt;</span>
<a name="l140"><span class="ln">140  </span></a><span class="s0">&lt;DIR&gt;</span>
<a name="l141"><span class="ln">141  </span></a>
<a name="l142"><span class="ln">142  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_reg_clsid_ = &quot;{7CC9F362-486D-11D1-BB48-0000E838A65F}&quot;</span><span class="s0">&lt;/P&gt;</span>
<a name="l143"><span class="ln">143  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_reg_desc_ = &quot;Python Test COM Server&quot;</span><span class="s0">&lt;/P&gt;</span>
<a name="l144"><span class="ln">144  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_reg_progid_ = &quot;Python.TestServer&quot;</span><span class="s0">&lt;/P&gt;</span>
<a name="l145"><span class="ln">145  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_public_methods_ = ['Hello']</span><span class="s0">&lt;/P&gt;</span>
<a name="l146"><span class="ln">146  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">[same from here]</span><span class="s0">&lt;/P&gt;&lt;/DIR&gt;</span>
<a name="l147"><span class="ln">147  </span></a><span class="s0">&lt;/DIR&gt;</span>
<a name="l148"><span class="ln">148  </span></a>
<a name="l149"><span class="ln">149  </span></a><span class="s0">&lt;/CODE&gt;&lt;H4&gt;</span><span class="s1">Registering the Class</span><span class="s0">&lt;/H4&gt;</span>
<a name="l150"><span class="ln">150  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">The idiom that most Python COM Servers use is that they register themselves when run as a script (ie, when executed from the command line.) Thus the standard &quot;</span><span class="s0">&lt;CODE&gt;</span><span class="s1">if __name__=='__main___':</span><span class="s0">&lt;/CODE&gt;</span><span class="s1">&quot; technique works well.</span><span class="s0">&lt;/P&gt;</span>
<a name="l151"><span class="ln">151  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">win32com.server.register contains a number of helper functions. The easiest to use is &quot;</span><span class="s0">&lt;CODE&gt;</span><span class="s1">UseCommandLine</span><span class="s0">&lt;/CODE&gt;</span><span class="s1">&quot;.</span><span class="s0">&lt;/P&gt;</span>
<a name="l152"><span class="ln">152  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Registration becomes as simple as:</span><span class="s0">&lt;/P&gt;</span>
<a name="l153"><span class="ln">153  </span></a><span class="s0">&lt;CODE&gt;&lt;P&gt;</span><span class="s1">if __name__=='__main__':</span><span class="s0">&lt;BR&gt;</span>
<a name="l154"><span class="ln">154  </span></a><span class="s4">&amp;#9;</span><span class="s1"># ni only for 1.4!</span><span class="s0">&lt;BR&gt;</span>
<a name="l155"><span class="ln">155  </span></a><span class="s4">&amp;#9;</span><span class="s1">import ni, win32com.server.register </span><span class="s0">&lt;BR&gt;</span>
<a name="l156"><span class="ln">156  </span></a><span class="s4">&amp;#9;</span><span class="s1">win32com.server.register.UseCommandLine(HelloWorld)</span><span class="s0">&lt;/P&gt;</span>
<a name="l157"><span class="ln">157  </span></a><span class="s0">&lt;/CODE&gt;&lt;P&gt;</span><span class="s1">Running the script will register our test server.</span><span class="s0">&lt;/P&gt;</span>
<a name="l158"><span class="ln">158  </span></a><span class="s0">&lt;H2&gt;&lt;A </span><span class="s2">NAME</span><span class="s3">=&quot;testing&quot;</span><span class="s0">&gt;</span><span class="s1">Testing our Class</span><span class="s0">&lt;/A&gt;&lt;/H2&gt;</span>
<a name="l159"><span class="ln">159  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">For the purposes of this demonstration, we will test the class using Visual Basic. This code should run under any version of Visual Basic, including VBA found in Microsoft Office. Any COM compliant package could be used alternatively. VB has been used just to prove there is no &quot;smoke and mirrors. For information on how to test the server using Python, please see the </span><span class="s0">&lt;A </span><span class="s2">HREF</span><span class="s3">=&quot;QuickStartClientCom.html&quot;</span><span class="s0">&gt;</span><span class="s1">Quick Start to Client side COM</span><span class="s0">&lt;/A&gt; </span><span class="s1">documentation.</span><span class="s0">&lt;/P&gt;</span>
<a name="l160"><span class="ln">160  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">This is not a tutorial in VB. The code is just presented! Run it, and it will work!</span><span class="s0">&lt;/P&gt;</span>
<a name="l161"><span class="ln">161  </span></a><span class="s0">&lt;H2&gt;&lt;A </span><span class="s2">NAME</span><span class="s3">=&quot;debugging&quot;</span><span class="s0">&gt;</span><span class="s1">Debugging the COM Server</span><span class="s0">&lt;/A&gt;&lt;/H2&gt;</span>
<a name="l162"><span class="ln">162  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">When things go wrong in COM Servers, there is often nowhere useful for the Python traceback to go, even if such a traceback is generated.</span><span class="s0">&lt;/P&gt;</span>
<a name="l163"><span class="ln">163  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Rather than discuss how it works, I will just present the procedure to debug your server:</span><span class="s0">&lt;/P&gt;</span>
<a name="l164"><span class="ln">164  </span></a><span class="s0">&lt;B&gt;&lt;P&gt;</span><span class="s1">To register a debug version of your class</span><span class="s0">&lt;/B&gt;</span><span class="s1">, run the script (as above) but pass in a &quot;</span><span class="s0">&lt;CODE&gt;</span><span class="s1">--debug</span><span class="s0">&lt;/CODE&gt;</span><span class="s1">&quot; parameter. Eg, for the server above, use the command line &quot;</span><span class="s0">&lt;CODE&gt;</span><span class="s1">testcomserver.py --debug</span><span class="s0">&lt;/CODE&gt;</span><span class="s1">&quot;.</span><span class="s0">&lt;/P&gt;</span>
<a name="l165"><span class="ln">165  </span></a><span class="s0">&lt;B&gt;&lt;P&gt;</span><span class="s1">To see the debug output generated</span><span class="s0">&lt;/B&gt; </span><span class="s1">(and any print statements you may choose to add!) you can simply select the &quot;Remote Debug Trace Collector&quot; from the Pythonwin Tools menu, or run the script &quot;win32traceutil.py&quot; from Windows Explorer or a Command Prompt.</span><span class="s0">&lt;/P&gt;</span>
<a name="l166"><span class="ln">166  </span></a><span class="s0">&lt;H2&gt;&lt;A </span><span class="s2">NAME</span><span class="s3">=&quot;Exception&quot;</span><span class="s0">&gt;</span><span class="s1">Exception Handling </span><span class="s0">&lt;/A&gt;&lt;/H2&gt;</span>
<a name="l167"><span class="ln">167  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Servers need to be able to provide exception information to their client. In some cases, it may be a simple return code (such as E_NOTIMPLEMENTED), but often it can contain much richer information, describing the error on detail, and even a help file and topic where more information can be found. </span><span class="s0">&lt;/P&gt;</span>
<a name="l168"><span class="ln">168  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">We use Python class based exceptions to provide this information. The COM framework will examine the exception, and look for certain known attributes. These attributes will be copied across to the COM exception, and passed back to the client. </span><span class="s0">&lt;/P&gt;</span>
<a name="l169"><span class="ln">169  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">The following attributes are supported, and correspond to the equivalent entry in the COM Exception structure:</span><span class="s0">&lt;BR&gt;</span>
<a name="l170"><span class="ln">170  </span></a><span class="s0">&lt;CODE&gt;</span><span class="s1">scode, code, description, source, helpfile and helpcontext</span><span class="s0">&lt;/P&gt;</span>
<a name="l171"><span class="ln">171  </span></a><span class="s0">&lt;/CODE&gt;&lt;P&gt;</span><span class="s1">To make working with exceptions easier, there is a helper module &quot;win32com.server.exception.py&quot;, which defines a single class. An example of its usage would be: </span><span class="s0">&lt;/P&gt;</span>
<a name="l172"><span class="ln">172  </span></a><span class="s0">&lt;CODE&gt;&lt;P&gt;</span><span class="s1">raise COMException(desc=&quot;Must be a string&quot;,scode=winerror.E_INVALIDARG,helpfile=&quot;myhelp.hlp&quot;,...)</span><span class="s0">&lt;/CODE&gt; &lt;/P&gt;</span>
<a name="l173"><span class="ln">173  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">(Note the </span><span class="s0">&lt;CODE&gt;</span><span class="s1">COMException class supports (and translates) &quot;desc&quot; as a shortcut for &quot;description&quot;, but the framework requires &quot;description&quot;)</span><span class="s0">&lt;/P&gt;</span>
<a name="l174"><span class="ln">174  </span></a><span class="s0">&lt;/CODE&gt;&lt;H2&gt;&lt;A </span><span class="s2">NAME</span><span class="s3">=&quot;Policies&quot;</span><span class="s0">&gt;</span><span class="s1">Server Policies</span><span class="s0">&lt;/A&gt;&lt;/H2&gt;</span>
<a name="l175"><span class="ln">175  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">This is information about how it all hangs together. The casual COM author need not know this. </span><span class="s0">&lt;/P&gt;</span>
<a name="l176"><span class="ln">176  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Whenever a Python Server needs to be created, the C++ framework first instantiates a &quot;policy&quot; object. This &quot;policy&quot; object is the gatekeeper for the COM Server - it is responsible for creating the underlying Python object that is the server (ie, your object), and also for translating the underlying COM requests for the object. </span><span class="s0">&lt;/P&gt;</span>
<a name="l177"><span class="ln">177  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">This policy object handles all of the underlying COM functionality. For example, COM requires all methods and properties to have unique numeric ID's associated with them. The policy object manages the creation of these ID's for the underlying Python methods and attributes. Similarly, when the client whishes to call a method with ID 123, the policy object translates this back to the actual method, and makes the call. </span><span class="s0">&lt;/P&gt;</span>
<a name="l178"><span class="ln">178  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">It should be noted that the operation of the &quot;policy&quot; object could be dictated by the Python object - the policy object has many defaults, but the actual Python class can always dictate its operation. </span><span class="s0">&lt;/P&gt;</span>
<a name="l179"><span class="ln">179  </span></a><span class="s0">&lt;H3&gt;</span><span class="s1">Default Policy attributes </span><span class="s0">&lt;/H3&gt;</span>
<a name="l180"><span class="ln">180  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">The default policy object has a few special attributes that define who the object is exposed to COM. The example above shows the _public_methods attribute, but this section describes all such attributes in detail. </span><span class="s0">&lt;/P&gt;</span>
<a name="l181"><span class="ln">181  </span></a><span class="s0">&lt;H5&gt;</span><span class="s1">_public_methods_ </span><span class="s0">&lt;/H5&gt;</span>
<a name="l182"><span class="ln">182  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Required list of strings, containing the names of all methods to be exposed to COM. It is possible this will be enhanced in the future (eg, possibly '*' will be recognised to say all methods, or some other ideas…) </span><span class="s0">&lt;/P&gt;</span>
<a name="l183"><span class="ln">183  </span></a><span class="s0">&lt;H5&gt;</span><span class="s1">_public_attrs_ </span><span class="s0">&lt;/H5&gt;</span>
<a name="l184"><span class="ln">184  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Optional list of strings containing all attribute names to be exposed, both for reading and writing. The attribute names must be valid instance variables. </span><span class="s0">&lt;/P&gt;</span>
<a name="l185"><span class="ln">185  </span></a><span class="s0">&lt;H5&gt;</span><span class="s1">_readonly_attrs_ </span><span class="s0">&lt;/H5&gt;</span>
<a name="l186"><span class="ln">186  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Optional list of strings defining the name of attributes exposed read-only. </span><span class="s0">&lt;/P&gt;</span>
<a name="l187"><span class="ln">187  </span></a><span class="s0">&lt;H5&gt;</span><span class="s1">_com_interfaces_ </span><span class="s0">&lt;/H5&gt;</span>
<a name="l188"><span class="ln">188  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">Optional list of IIDs exposed by this object. If this attribute is missing, IID_IDispatch is assumed (ie, if not supplied, the COM object will be created as a normal Automation object.</span><span class="s0">&lt;/P&gt;</span>
<a name="l189"><span class="ln">189  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">and actual instance attributes: </span><span class="s0">&lt;/P&gt;</span>
<a name="l190"><span class="ln">190  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_dynamic_ : optional method </span><span class="s0">&lt;/P&gt;</span>
<a name="l191"><span class="ln">191  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_value_ : optional attribute </span><span class="s0">&lt;/P&gt;</span>
<a name="l192"><span class="ln">192  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_query_interface_ : optional method </span><span class="s0">&lt;/P&gt;</span>
<a name="l193"><span class="ln">193  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_NewEnum : optional method </span><span class="s0">&lt;/P&gt;</span>
<a name="l194"><span class="ln">194  </span></a><span class="s0">&lt;P&gt;</span><span class="s1">_Evaluate : optional method </span><span class="s0">&lt;/P&gt;&lt;/BODY&gt;</span>
<a name="l195"><span class="ln">195  </span></a><span class="s0">&lt;/HTML&gt;</span>
<a name="l196"><span class="ln">196  </span></a></pre>
</body>
</html>